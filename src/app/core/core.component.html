<div style="visibility: hidden; position: absolute;"
[style.left]="menuPosition.x"
[style.top]="menuPosition.y"
[matMenuTriggerFor]="menu"
></div>

<svg class="desLineSVG">
    <line [attr.x1]=desLinePos.x1 [attr.y1]=desLinePos.y1 [attr.x2]=desLinePos.x2 [attr.y2]=desLinePos.y2 style="stroke:#DCDCDC;stroke-width:1" [attr.visibility]=designLineVis/>
</svg>


<div class="coreHitBox" cdkDragBoundary=".stageDisplay" fxLayout="row" cdkDrag (cdkDragEnded)="onDrop($event)" [attr.width]="shellSize[0] + 25" [attr.height]="shellSize[1]"
    [ngStyle]="initialPos()"
>                                                                                                                                                               

    <!-- Core Menu BUTTON  -->
    <div  cdkDragHandle class="core-menu-handle" >   
        <button fxLayout="column"  class="core-menu-button" matTooltip="Open Core-Menu or Drag the Core" matTooltipShowDelay="1000"
            (mousedown)="onHoldStart()" (mouseup)="onHoldEnd($event)" >
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
        </button>
    </div>

    <!-- Core Menu  -->

    <mat-menu #menu="matMenu" >
        <button mat-menu-item [matMenuTriggerFor]="actions">
            <img src="assets\Icon\Actions_Icon.png" class="iconAct">
            <span class="iconText">Actions</span>
        </button>
        <button mat-menu-item [matMenuTriggerFor]="modifications">
            <img src="assets\Icon\Modifications_Icon.png" class="icon">
            <span class="iconText">Modifications</span>
        </button>
        <button mat-menu-item (click)="DesignButtonDyn()" cdkOverlayOrigin #trigger="cdkOverlayOrigin" matTooltip="Open Shell Design Window" matTooltipShowDelay="1000"> 
            <img src="assets\Icon\Design_Icon.png" class="icon">
            <span class="iconText">Design</span>
        </button>
        <div class="gizmoCont">
            <div class="verticalG"><mat-icon class="gizArrowV">arrow_drop_up</mat-icon></div>
            <div class="horizontalG"><mat-icon  class="gizArrowH">arrow_left</mat-icon></div>
            <div class="bothG" cdkDragHandle></div>
            <img src="assets\QuarterCircle.png" class="circleSec">
            <div class="rotCircle"></div>
        </div>
    </mat-menu>


    <mat-menu #actions="matMenu">
        <button mat-menu-item >
            <img src="assets\Icon\Actions_Delete_Icon.png" class="iconAct">
            <span>Delete Core</span>
        </button>
        <button mat-menu-item>
            <img src="assets\Icon\Actions_Duplicate_Icon.png" class="icon">
            <span>Duplicate Core</span>
        </button>
        <button mat-menu-item>
            <img src="assets\Icon\Actions_Hyper_Icon.png" class="icon">
            <span>Hyperlink Core</span>
        </button>
        <button mat-menu-item>
            <img src="assets\Icon\Actions_Bonds_Icon.png" class="icon">
            <span>List of Bonds</span>
        </button>
    </mat-menu>
    <mat-menu #modifications="matMenu">
        <button mat-menu-item>
            <img src="assets\Icon\Mods_Add_Icon.png" class="icon">
            <span>Add Rune</span>
        </button>
        <button mat-menu-item>
            <img src="assets\Icon\Mods_List_Icon.png" class="icon">
            <span>List of Runes</span>
        </button>
    </mat-menu>

    <!-- Design Menu -->
    <ng-template
        cdkConnectedOverlay
        [cdkConnectedOverlayOrigin]="trigger"
        [cdkConnectedOverlayOpen]="designIsOpen"
        (attach)="loadPolly()"
    >
        <div class="designMenu" cdkDrag (cdkDragEnded)="onDesignDrop($event)"  (cdkDragStarted)="onDesHold()"  fxLayout="column">
            <div cdkDragHandle matRipple (mouseup)="getMousePos($event)" class="designDragHandle" matTooltip="Drag the Design Menu" matTooltipShowDelay="800" matTooltipPosition="before">
                <span class="dot2"></span>
                <span class="dot2"></span>
                <span class="dot2"></span>
            </div>
            <mat-tab-group   mat-align-tabs="start" fxFlex  (focusChange)="closeDesign($event)" >

                <!-- Design Menu FRAME TAB -->
                <mat-tab class="tabDes">
                    <ng-template mat-tab-label>
                        <img src="assets\Icon\Design_Frame.png" class="iconDesTab">
                        Frame
                    </ng-template>

                    <div fxLayout="row" class="desWin2">

                        <!-- Frame Tab TOOLS -->
                        <div class="desTools" fxLayout="column">
                            <div class="toolRow" fxLayout="row">
                                <button mat-stroked-button fxFlex matTooltip="Transform" matTooltipShowDelay="500" matTooltipPosition="before"> <img src="assets\Icon\Design_Frame_Transform.png" class="iconT"> </button>
                                <button mat-stroked-button fxFlex matTooltip="Select" matTooltipShowDelay="500" matTooltipPosition="after"> <img src="assets\Icon\Design_Frame_Select.png" class="iconT"> </button>
                            </div>
                            <div class="toolRow" fxLayout="row">
                                <button mat-stroked-button fxFlex matTooltip="Spline" matTooltipShowDelay="500" matTooltipPosition="before"> <img src="assets\Icon\Design_Frame_Spline.png" class="iconT"> </button>
                                <button mat-stroked-button fxFlex matTooltip="Blob" matTooltipShowDelay="500" matTooltipPosition="after"> <img src="assets\Icon\Design_Frame_Blob.png" class="iconT"> </button>
                            </div>
                            <div class="toolRow">
                                <button mat-stroked-button [matMenuTriggerFor]="shapes"
                                fxFlex matTooltip="Shapes" matTooltipShowDelay="500" matTooltipPosition="before"> <img src="assets\Icon\Design_Frame_Shapes.png" class="iconT"> </button>
                            </div>
                            <div class="toolRow" fxLayout="row">
                                <button mat-stroked-button [matMenuTriggerFor]="transparency"
                                fxFlex matTooltip="Transparency" matTooltipShowDelay="500" matTooltipPosition="before"> <img src="assets\Icon\Design_Frame_Transparency.png" class="iconT"> </button>
                                <button mat-stroked-button [matMenuTriggerFor]="colour"
                                fxFlex matTooltip="Colour" matTooltipShowDelay="500" matTooltipPosition="after"> <img src="assets\Icon\Design_Frame_Colour.png" class="iconT"> </button>
                            </div>
                            <div class="toolRow" fxLayout="row">
                                <button mat-stroked-button [matMenuTriggerFor]="thickness"
                                fxFlex matTooltip="Line Thickness" matTooltipShowDelay="500" matTooltipPosition="before"> <img src="assets\Icon\Design_Frame_Thickness.png" class="iconT"> </button>
                                <button mat-stroked-button [matMenuTriggerFor]="emmitance"
                                fxFlex matTooltip="Frame Emmitance" matTooltipShowDelay="500" matTooltipPosition="after"> <img src="assets\Icon\Design_Frame_Emmitance.png" class="iconT"> </button>
                            </div>
                            <div class="toolRow">
                                <button mat-stroked-button fxFlex matTooltip="Add Frame Instance" matTooltipShowDelay="500" matTooltipPosition="before"> <img src="assets\Icon\Design_Frame_AddFrameInst.png" class="iconT"> </button>
                            </div>
                        </div>

                        <!-- Frame Tab DISPLAY -->
                        <div class="desDivs">
                            <div [ngSwitch]="coreData.frameFile" class="svgDesign">

                                <!-- CIRCLE/ELLIPSE Frame -->
                                <svg *ngSwitchCase="'ellipse'"  class="svgDesign">
                        
                                    <text *ngIf="datumType === 'text'"  [attr.y]="coreData.frameThickness/2" [attr.x]="coreData.frameThickness/2"
                                        [attr.x]="textX" [attr.y]="textY" fill="black" > {{coreData.datumText}} </text>
                        
                                    <image *ngIf="datumType === 'image'"  [attr.y]="coreData.frameThickness/2" [attr.x]="coreData.frameThickness/2"
                                        [attr.href]="coreData.datumText" [attr.width]="coreData.datumSize[0]" opacity="0.5" /> 

                                    <text *ngIf="datumType === 'text'"  [attr.y]="coreData.frameThickness/2" [attr.x]="coreData.frameThickness/2"
                                        [ngStyle]="{'clip-path': 'ellipse('+ shellSize[0]/(2*browserZoomLevel)  + 'px ' + shellSize[1]/(2*browserZoomLevel) + 'px at ' + (shellSize[0]/(2*browserZoomLevel) ) + 'px ' + (shellSize[1]/(2*browserZoomLevel) ) + 'px )'}"
                                        [attr.x]="textX" [attr.y]="textY" fill="black" > {{coreData.datumText}} </text>
                        
                                    <image *ngIf="datumType === 'image'"  [attr.y]="coreData.frameThickness/2" [attr.x]="coreData.frameThickness/2"
                                        [ngStyle]="{'clip-path': 'ellipse('+ shellSize[0]/(2*browserZoomLevel)  + 'px ' + shellSize[1]/(2*browserZoomLevel) + 'px at ' + (shellSize[0]/(2*browserZoomLevel) ) + 'px ' + (shellSize[1]/(2*browserZoomLevel) ) + 'px )'}"
                                        [attr.href]="coreData.datumText" [attr.width]="coreData.datumSize[0]" /> 
                        
                        
                                    <ellipse *ngIf="shellShape === 'ellipse'"
                                        [attr.rx]="coreData.size[0]/2" [attr.ry]="coreData.size[1]/2" [attr.cx]="coreData.size[0]/2 + coreData.frameThickness/2"  [attr.cy]="coreData.size[1]/2  + coreData.frameThickness/2"
                                        [attr.stroke-width]="coreData.frameThickness" [attr.stroke]="coreData.frameColor" [attr.stroke-opacity]="coreData.frameTransparency" 
                                        fill="white" fill-opacity="0" />
                                    
                                </svg>
                        
                                <!-- POLYGON Frame  -->
                                <svg *ngSwitchCase="'polygon'" xmlns="http://www.w3.org/2000/svg" id="SVGpolygonFrameF" #svgPolyFrameF  class="svgDesign" >
                                    
                                    <text *ngIf="datumType === 'text'"  [attr.x]="textX" [attr.y]="textY" fill="black" > {{coreData.datumText}} </text>
                        
                                    <image *ngIf="datumType === 'image'"  [attr.href]="coreData.datumText" [attr.width]="coreData.datumSize[0]" opacity="0.5" /> 

                                    <text *ngIf="datumType === 'text'"  [attr.x]="textX" [attr.y]="textY" fill="black" 
                                    [ngStyle]="{'clip-path':'polygon(' + pointsPXtext + ')'}" > {{coreData.datumText}} </text>
                    
                                    <image *ngIf="datumType === 'image'"  [attr.href]="coreData.datumText" [attr.width]="coreData.datumSize[0]"
                                    [ngStyle]="{'clip-path':'polygon(' + pointsPXtext + ')'}" /> 
                                    
                                    <polygon
                                        id="polygonFrameF" #svgPolyF points="" class="shellX"
                                        [attr.stroke-width]="coreData.frameThickness" [attr.stroke]="coreData.frameColor" [attr.stroke-opacity]="coreData.frameTransparency"
                                        fill="white" fill-opacity="0" />
                                        
                                </svg>
                        
                                <!-- RECTANGLE Frame -->
                                <svg *ngSwitchCase="'rectangle'"   class="svgDesign" >
                        
                                    <text *ngIf="datumType === 'text'"  
                                        [attr.x]="textX" [attr.y]="textY" fill="black" opacity="0.5"> {{coreData.datumText}} </text>
                        
                                    <image *ngIf="datumType === 'image'"
                                        [attr.href]="coreData.datumText" [attr.width]="coreData.datumSize[0]" opacity="0.5" />


                                    <text *ngIf="datumType === 'text'"  
                                        [attr.x]="textX" [attr.y]="textY" fill="black" 
                                        [ngStyle]="{'clip-path':'inset( 0px ' + (coreData.datumSize[0] - shellSize[0])/browserZoomLevel + 'px ' + ((coreData.datumSize[0]*(imageHeight/imageWidth)) - shellSize[1])/(browserZoomLevel) + 'px 0px round ' + (rectBorderRadius + (coreData.frameThickness/2))/(browserZoomLevel) +'px )'}" 
                                        > {{coreData.datumText}} </text>
                        
                                    <image *ngIf="datumType === 'image'" id="rectImage"
                                        [ngStyle]="{'clip-path':'inset( 0px ' + (coreData.datumSize[0] - shellSize[0])/browserZoomLevel + 'px ' + ((coreData.datumSize[0]*(imageHeight/imageWidth)) - shellSize[1])/(browserZoomLevel) + 'px 0px round ' + (rectBorderRadius + (coreData.frameThickness/2))/(browserZoomLevel) +'px )'}"
                                        [attr.href]="coreData.datumText" [attr.width]="coreData.datumSize[0]" />   
            
                                    
                                    <rect [attr.rx]="rectBorderRadius +'px'" [attr.rx]="rectBorderRadius +'px'" class="shellX"
                                        [attr.x]="coreData.frameThickness/2"  [attr.y]="coreData.frameThickness/2"  [attr.width]="shellSize[0] - (coreData.frameThickness)" [attr.height]="shellSize[1] - (coreData.frameThickness)"  
                                        [attr.stroke-width]="coreData.frameThickness" [attr.stroke]="coreData.frameColor" [attr.stroke-opacity]="coreData.frameTransparency" 
                                        fill="white" fill-opacity="0" />
                        
                                </svg>
                            </div>
                        </div>
                    </div>
                </mat-tab>
            
                <!-- Design Menu GLAZING TAB -->
                <mat-tab class="tabDes">
                    <ng-template mat-tab-label>
                        <img src="assets\Icon\Design_Glazing.png" class="iconDesTab">
                        Glazing
                    </ng-template>
                    
                    <div fxLayout="row" class="desWin2">

                        <!-- Glazing Tab TOOLS -->
                        <div class="desTools" fxLayout="column">
                            <div class="menuText">Drawing Tools</div>
                            <div class="toolRow" fxLayout="row">
                                <button mat-stroked-button fxFlex matTooltip="Pencil" matTooltipShowDelay="500" matTooltipPosition="before"> <img src="assets\Icon\Design_Glazing_Pencil.png" class="iconT"> </button>
                                <button mat-stroked-button fxFlex matTooltip="Spline" matTooltipShowDelay="500" matTooltipPosition="after"> <img src="assets\Icon\Design_Frame_Spline.png" class="iconT"> </button>
                            </div>
                            <div class="toolRow" fxLayout="row">
                                <button mat-stroked-button [matMenuTriggerFor]="thickness"
                                fxFlex matTooltip="Line Thickness" matTooltipShowDelay="500" matTooltipPosition="before"> <img src="assets\Icon\Design_Frame_Thickness.png" class="iconT"> </button>
                                <button mat-stroked-button fxFlex matTooltip="Eraser" matTooltipShowDelay="500" matTooltipPosition="after"> <img src="assets\Icon\Design_Glazing_Eraser.png" class="iconT"> </button>
                            </div>
                            <div class="toolRow">
                                <button mat-stroked-button [matMenuTriggerFor]="shapes"
                                fxFlex matTooltip="Shapes" matTooltipShowDelay="500" matTooltipPosition="before"> <img src="assets\Icon\Design_Frame_Shapes.png" class="iconT"> </button>
                            </div>
                            <div class="toolRow" fxLayout="row">
                                <button mat-stroked-button [matMenuTriggerFor]="transparency"
                                fxFlex matTooltip="Drawing Transparency" matTooltipShowDelay="500" matTooltipPosition="before">  <img src="assets\Icon\Design_Frame_Transparency.png" class="iconT"> </button>
                                <button mat-stroked-button [matMenuTriggerFor]="colour"
                                fxFlex matTooltip="Drawing Colour" matTooltipShowDelay="500" matTooltipPosition="after"> <img src="assets\Icon\Design_Frame_Colour.png" class="iconT"> </button>
                            </div>
                            <mat-divider></mat-divider>
                            <div class="menuText">Background</div> 
                            <div class="toolRow" fxLayout="row">
                                <button mat-stroked-button [matMenuTriggerFor]="transparency"
                                fxFlex matTooltip="Background Transparency" matTooltipShowDelay="500" matTooltipPosition="before"> <img src="assets\Icon\Design_Frame_Transparency.png" class="iconT"> </button>
                                <button mat-stroked-button [matMenuTriggerFor]="colour"
                                fxFlex matTooltip="Background Colour" matTooltipShowDelay="500" matTooltipPosition="after"> <img src="assets\Icon\Design_Frame_Colour.png" class="iconT"> </button>
                            </div>
                        </div>

                        <!-- Glazing Tab DISPLAY -->
                        <div class="desDivs">
                            <div [ngSwitch]="coreData.frameFile"  class="svgDesign" >

                                <!-- CIRCLE/ELLIPSE Glazing -->
                                <svg *ngSwitchCase="'ellipse'" class="svgDesign" >
                        
                                    <text *ngIf="datumType === 'text'"  [attr.y]="coreData.frameThickness/2" [attr.x]="coreData.frameThickness/2"
                                        [attr.x]="textX" [attr.y]="textY" fill="black" > {{coreData.datumText}} </text>
                        
                                    <image *ngIf="datumType === 'image'"  [attr.y]="coreData.frameThickness/2" [attr.x]="coreData.frameThickness/2"
                                        [attr.href]="coreData.datumText" [attr.width]="coreData.datumSize[0]" /> 

                        
                                    <ellipse *ngIf="shellShape === 'ellipse'"
                                        [attr.rx]="coreData.size[0]/2" [attr.ry]="coreData.size[1]/2" [attr.cx]="coreData.size[0]/2 + coreData.frameThickness/2"  [attr.cy]="coreData.size[1]/2  + coreData.frameThickness/2"
                                        [attr.stroke-width]="coreData.frameThickness" [attr.stroke]="coreData.frameColor" [attr.stroke-opacity]="coreData.frameTransparency" 
                                        [attr.fill]="coreData.glazingColor" [attr.fill-opacity]="coreData.glazingTransparency" />
                                    
                                </svg>
                        
                                <!-- POLYGON Glazing -->
                                <svg *ngSwitchCase="'polygon'" xmlns="http://www.w3.org/2000/svg" id="SVGpolygonFrameG" #svgPolyFrameG  class="svgDesign"  >
                                    
                                    <text *ngIf="datumType === 'text'"  [attr.x]="textX" [attr.y]="textY" fill="black" > {{coreData.datumText}} </text>
                        
                                    <image *ngIf="datumType === 'image'"  [attr.href]="coreData.datumText" [attr.width]="coreData.datumSize[0]" /> 
                                    
                                    <polygon 
                                        id="polygonFrameG" #svgPolyG points="" class="shellX" 
                                        [attr.stroke-width]="coreData.frameThickness" [attr.stroke]="coreData.frameColor" stroke-opacity="0.5" 
                                        [attr.fill]="coreData.glazingColor" [attr.fill-opacity]="coreData.glazingTransparency" />
                                        
                                </svg>
                        
                                <!-- RECTANGLE Glazing -->
                                <svg *ngSwitchCase="'rectangle'" class="svgDesign" >
                        
                                    <text *ngIf="datumType === 'text'"  
                                        [attr.x]="textX" [attr.y]="textY" fill="black" > {{coreData.datumText}} </text>
                        
                                    <image *ngIf="datumType === 'image'"
                                        [attr.href]="coreData.datumText" [attr.width]="coreData.datumSize[0]"/>             
                                    
                                    
                                    <rect [attr.rx]="rectBorderRadius +'px'" ry="10px" class="shellX"
                                        [attr.x]="coreData.frameThickness/2"  [attr.y]="coreData.frameThickness/2"  [attr.width]="shellSize[0] - (coreData.frameThickness)" [attr.height]="shellSize[1] - (coreData.frameThickness)"  
                                        [attr.stroke-width]="coreData.frameThickness" [attr.stroke]="coreData.frameColor" [attr.stroke-opacity]="coreData.frameTransparency" 
                                        [attr.fill]="coreData.glazingColor" [attr.fill-opacity]="coreData.glazingTransparency" />
                        
                                </svg>
                            </div>
                        </div>
                    </div>
                </mat-tab>
            
                <!-- Design Menu DATUM TAB -->
                <mat-tab class="tabDes">
                    <ng-template mat-tab-label>
                        <img src="assets\Icon\Design_Datum.png" class="iconDesTab">
                        Datum
                    </ng-template>
                    
                    <div fxLayout="row" class="desWin2">

                        <!-- Datum Tab TOOLS -->
                        <div class="desTools" fxLayout="column">
                            <div class="toolRow">
                                <button mat-stroked-button fxFlex matTooltip="Datum Type">Verse</button>
                            </div>
                            <mat-divider></mat-divider>
                            <div class="toolRow">
                                <button mat-stroked-button fxFlex matTooltip="Font">Helvetica</button>
                            </div>
                            <div class="toolRow" fxLayout="row">
                                <button mat-icon-button fxFlex matTooltip="Bold" matTooltipShowDelay="500" matTooltipPosition="before"> <img src="assets\Icon\Design_Datum_Bold.png" class="iconV"> </button>
                                <button mat-icon-button fxFlex matTooltip="Italics" matTooltipShowDelay="800"> <img src="assets\Icon\Design_Datum_Italics.png" class="iconV"> </button>
                                <button mat-icon-button fxFlex matTooltip="Underscore" matTooltipShowDelay="500" matTooltipPosition="after"> <img src="assets\Icon\Design_Datum_Underscore.png" class="iconV"> </button>
                            </div>
                            <div class="toolRow" fxLayout="row">
                                <button mat-stroked-button fxFlex matTooltip="Font Size" matTooltipShowDelay="500" matTooltipPosition="before"> 16 </button>
                                <button mat-stroked-button [matMenuTriggerFor]="colour"
                                fxFlex matTooltip="Colour" matTooltipShowDelay="500" matTooltipPosition="after"> <img src="assets\Icon\Design_Datum_FontColor.png" class="iconT"> </button>
                            </div>
                            <div class="toolRow" fxLayout="row">
                                <button mat-stroked-button fxFlex matTooltip="Justification" matTooltipShowDelay="500" matTooltipPosition="before"> <img src="assets\Icon\Design_Datum_Justify.png" class="iconT"> </button>
                                <button mat-stroked-button fxFlex matTooltip="List" matTooltipShowDelay="500" matTooltipPosition="after"> <img src="assets\Icon\Design_Datum_List.png" class="iconT"> </button>
                            </div>
                            <mat-divider></mat-divider>
                            <div fxLayout="column" class="checkedDes2">
                                <mat-checkbox class="checkedDes" fxFlex matTooltip="Share Datum with other Cores" matTooltipShowDelay="500" matTooltipPosition="before">Cast Datum</mat-checkbox>
                                <mat-checkbox class="checkedDes" fxFlex matTooltip="Display Core's Name in Shell" matTooltipShowDelay="500" matTooltipPosition="after"> Show Name</mat-checkbox>
                            </div>
                            <mat-divider></mat-divider>
                            <div class="toolRow">
                                <button mat-stroked-button color="warn" fxFlex>Clear Datum</button>
                            </div>
                        </div>

                        <!-- Datum Tab DISPLAY -->
                        <div class="desDivs">
                            <div [ngSwitch]="coreData.frameFile" class="svgDesign">

                                <!-- CIRCLE/ELLIPSE Datum -->
                                <svg *ngSwitchCase="'ellipse'" class="svgDesign"  >
                        
                                    <text *ngIf="datumType === 'text'"  [attr.y]="coreData.frameThickness/2" [attr.x]="coreData.frameThickness/2"
                                        [attr.x]="textX" [attr.y]="textY" fill="black" > {{coreData.datumText}} </text>
                        
                                    <image *ngIf="datumType === 'image'"  [attr.y]="coreData.frameThickness/2" [attr.x]="coreData.frameThickness/2"
                                        [attr.href]="coreData.datumText" [attr.width]="coreData.datumSize[0]" /> 
                        
                                    <ellipse *ngIf="shellShape === 'ellipse'"
                                        [attr.rx]="coreData.size[0]/2" [attr.ry]="coreData.size[1]/2" [attr.cx]="coreData.size[0]/2 + coreData.frameThickness/2"  [attr.cy]="coreData.size[1]/2  + coreData.frameThickness/2"
                                        [attr.stroke-width]="coreData.frameThickness" stroke="white" stroke-opacity="0.5" fill="white" fill-opacity="0.1" />
                                    
                                </svg>
                        
                                <!-- POLYGON Datum -->
                                <svg *ngSwitchCase="'polygon'" xmlns="http://www.w3.org/2000/svg" id="SVGpolygonFrameD" #svgPolyFrameD class="svgDesign"  >
                                    
                                    <text *ngIf="datumType === 'text'"  [attr.x]="textX" [attr.y]="textY" fill="black" > {{coreData.datumText}} </text>
                        
                                    <image *ngIf="datumType === 'image'"  [attr.href]="coreData.datumText" [attr.width]="coreData.datumSize[0]" /> 
                                    
                                    <polygon *ngIf="shellShape === 'polygon'"
                                        id="polygonFrameD" #svgPolyD points="" class="shellX" 
                                        [attr.stroke-width]="coreData.frameThickness" stroke="white" stroke-opacity="0.5" fill="white" fill-opacity="0.1"  />
                                        
                                </svg>
                        
                                <!-- RECTANGLE Datum -->
                                <svg *ngSwitchCase="'rectangle'" class="svgDesign"   >
                        
                                    <text *ngIf="datumType === 'text'"  
                                        [attr.x]="textX" [attr.y]="textY" fill="black" > {{coreData.datumText}} </text>
                        
                                    <image *ngIf="datumType === 'image'"
                                        [attr.href]="coreData.datumText" [attr.width]="coreData.datumSize[0]"/>             
                                    
                                    
                                    <rect [attr.rx]="rectBorderRadius +'px'" ry="10px" class="shellX"
                                        [attr.x]="coreData.frameThickness/2"  [attr.y]="coreData.frameThickness/2"  [attr.width]="shellSize[0] - (coreData.frameThickness)" [attr.height]="shellSize[1] - (coreData.frameThickness)"  
                                        [attr.stroke-width]="coreData.frameThickness" stroke="white" stroke-opacity="0.5" fill="white" fill-opacity="0.1" />
                        
                                </svg>
                            </div>
                        </div>
                    </div>
                </mat-tab>

                <!-- Close Button -->
                <mat-tab >
                    <ng-template mat-tab-label>
                        <mat-icon matTooltip="Close Design Window">close</mat-icon>
                    </ng-template>
                </mat-tab>
            </mat-tab-group>
        </div>
    </ng-template>

    <!-- Core Menu sub-menues -->
    <mat-menu #shapes="matMenu"></mat-menu>
    <mat-menu #transparency="matMenu">
        <mat-slider invert="true" ></mat-slider>
    </mat-menu>
    <mat-menu #colour="matMenu"></mat-menu>
    <mat-menu #emmitance="matMenu">
        <mat-slider></mat-slider>
    </mat-menu>
    <mat-menu #thickness="matMenu"></mat-menu>


    <!-- Shell -->

    <div [ngSwitch]="coreData.frameFile">

        <!-- CIRCLE/ELLIPSE SHELL -->
        <svg *ngSwitchCase="'ellipse'" class="svgShell"  [attr.width]="shellSize[0] + coreData.frameThickness" [attr.height]="shellSize[1] + coreData.frameThickness">

            <text *ngIf="datumType === 'text'"  [attr.y]="coreData.frameThickness/2" [attr.x]="coreData.frameThickness/2"
                [ngStyle]="{'clip-path': 'ellipse('+ shellSize[0]/(2*browserZoomLevel)  + 'px ' + shellSize[1]/(2*browserZoomLevel) + 'px at ' + (shellSize[0]/(2*browserZoomLevel) ) + 'px ' + (shellSize[1]/(2*browserZoomLevel) ) + 'px )'}"
                [attr.x]="textX" [attr.y]="textY" fill="black" > {{coreData.datumText}} </text>

            <image *ngIf="datumType === 'image'"  [attr.y]="coreData.frameThickness/2" [attr.x]="coreData.frameThickness/2"
                [ngStyle]="{'clip-path': 'ellipse('+ shellSize[0]/(2*browserZoomLevel)  + 'px ' + shellSize[1]/(2*browserZoomLevel) + 'px at ' + (shellSize[0]/(2*browserZoomLevel) ) + 'px ' + (shellSize[1]/(2*browserZoomLevel) ) + 'px )'}"
                [attr.href]="coreData.datumText" [attr.width]="coreData.datumSize[0]" /> 

            <ellipse *ngIf="shellShape === 'ellipse'"
                [attr.rx]="coreData.size[0]/2" [attr.ry]="coreData.size[1]/2" [attr.cx]="coreData.size[0]/2 + coreData.frameThickness/2"  [attr.cy]="coreData.size[1]/2  + coreData.frameThickness/2"
                [attr.stroke-width]="coreData.frameThickness" [attr.stroke]="coreData.frameColor" [attr.stroke-opacity]="coreData.frameTransparency" 
                [attr.fill]="coreData.glazingColor" [attr.fill-opacity]="coreData.glazingTransparency" />
            
        </svg>

        <!-- POLYGON SHELL -->
        <svg *ngSwitchCase="'polygon'" xmlns="http://www.w3.org/2000/svg" id="SVGpolygonFrame" #svgPolyFrame class="svgShell"  [attr.width]="shellSize[0]" [attr.height]="shellSize[1]">
            
            <text *ngIf="datumType === 'text'"  [attr.x]="textX" [attr.y]="textY" fill="black" 
                [ngStyle]="{'clip-path':'polygon(' + pointsPXtext + ')'}" > {{coreData.datumText}} </text>

            <image *ngIf="datumType === 'image'"  [attr.href]="coreData.datumText" [attr.width]="coreData.datumSize[0]"
                [ngStyle]="{'clip-path':'polygon(' + pointsPXtext + ')'}" /> 
            
            <polygon
                id="polygonFrame" #svgPoly points="" class="shellX" 
                [attr.stroke-width]="coreData.frameThickness" [attr.stroke]="coreData.frameColor" [attr.stroke-opacity]="coreData.frameTransparency" 
                [attr.fill]="coreData.glazingColor" [attr.fill-opacity]="coreData.glazingTransparency" />
                
        </svg>

        <!-- RECTANGLE SHELL -->
        <svg *ngSwitchCase="'rectangle'"  class="svgShell" [attr.width]="shellSize[0]" [attr.height]="shellSize[1]" >

            <text *ngIf="datumType === 'text'"  
                [attr.x]="textX" [attr.y]="textY" fill="black" 
                [ngStyle]="{'clip-path':'inset( 0px ' + (coreData.datumSize[0] - shellSize[0])/browserZoomLevel + 'px ' + ((coreData.datumSize[0]*(imageHeight/imageWidth)) - shellSize[1])/(browserZoomLevel) + 'px 0px round ' + (rectBorderRadius + (coreData.frameThickness/2))/(browserZoomLevel) +'px )'}" 
                > {{coreData.datumText}} </text>

             <image *ngIf="datumType === 'image'" id="rectImage"
                [ngStyle]="{'clip-path':'inset( 0px ' + (coreData.datumSize[0] - shellSize[0])/browserZoomLevel + 'px ' + ((coreData.datumSize[0]*(imageHeight/imageWidth)) - shellSize[1])/(browserZoomLevel) + 'px 0px round ' + (rectBorderRadius + (coreData.frameThickness/2))/(browserZoomLevel) +'px )'}"
                [attr.href]="coreData.datumText" [attr.width]="coreData.datumSize[0]" />    

         
            <rect [attr.rx]="rectBorderRadius +'px'" ry="10px" class="shellX"
                [attr.x]="coreData.frameThickness/2"  [attr.y]="coreData.frameThickness/2"  [attr.width]="shellSize[0] - (coreData.frameThickness)" [attr.height]="shellSize[1] - (coreData.frameThickness)"  
                [attr.stroke-width]="coreData.frameThickness" [attr.stroke]="coreData.frameColor" [attr.stroke-opacity]="coreData.frameTransparency"     
                [attr.fill]="coreData.glazingColor" [attr.fill-opacity]="coreData.glazingTransparency" />

        </svg>
    </div>
</div>

<!--coreData.frameTransparency-->
<!--   [ngStyle]="{'clip-path':'inset( 0px ' + (coreData.datumSize[0] - shellSize[0])/browserZoomLevel + 'px ' + (coreData.datumSize[1] - shellSize[1])/browserZoomLevel + 'px 0px )'}" 

[ngStyle]="{'border-radius': (rectBorderRadius + (coreData.frameThickness/2)) +'px'}"
-->