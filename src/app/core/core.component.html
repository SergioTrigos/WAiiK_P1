<div style="visibility: hidden; position: absolute;"
[style.left]="menuPosition.x"
[style.top]="menuPosition.y"
[matMenuTriggerFor]="menu"
></div>

<svg class="desLineSVG">
    <line [attr.x1]=desLinePos.x1 [attr.y1]=desLinePos.y1 [attr.x2]=desLinePos.x2 [attr.y2]=desLinePos.y2 style="stroke:#DCDCDC;stroke-width:1" [attr.visibility]=designLineVis/>
</svg>


<div class="coreHitBox" cdkDragBoundary=".stageDisplay" fxLayout="row" cdkDrag (cdkDragEnded)="onDrop($event)" [attr.width]="shellSize[0] + 25" [attr.height]="shellSize[1]"
    [ngStyle]="initialPos()"
>                                                                                                                                                               

    <!-- Core Menu BUTTON  -->
    <div  cdkDragHandle class="core-menu-handle" >   
        <button fxLayout="column"  class="core-menu-button" matTooltip="Open Core-Menu or Drag the Core" matTooltipShowDelay="1000"
            (mousedown)="onHoldStart()" (mouseup)="onHoldEnd($event)" >
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
        </button>
    </div>

    <!-- Core Menu  -->

    <mat-menu #menu="matMenu" >
        <button mat-menu-item [matMenuTriggerFor]="actions">
            <img src="assets\Icon\Actions_Icon.png" class="iconAct">
            <span class="iconText">Actions</span>
        </button>
        <button mat-menu-item [matMenuTriggerFor]="modifications">
            <img src="assets\Icon\Modifications_Icon.png" class="icon">
            <span class="iconText">Modifications</span>
        </button>
        <button mat-menu-item (click)="DesignButtonDyn()" cdkOverlayOrigin #trigger="cdkOverlayOrigin" matTooltip="Open Shell Design Window" matTooltipShowDelay="1000"> 
            <img src="assets\Icon\Design_Icon.png" class="icon">
            <span class="iconText">Design</span>
        </button>
        <div class="gizmoCont">
            <div class="verticalG"><mat-icon class="gizArrowV">arrow_drop_up</mat-icon></div>
            <div class="horizontalG"><mat-icon  class="gizArrowH">arrow_left</mat-icon></div>
            <div class="bothG" cdkDragHandle></div>
            <img src="assets\QuarterCircle.png" class="circleSec">
            <div class="rotCircle"></div>
        </div>
    </mat-menu>


    <mat-menu #actions="matMenu">
        <button mat-menu-item >
            <img src="assets\Icon\Actions_Delete_Icon.png" class="iconAct">
            <span>Delete Core</span>
        </button>
        <button mat-menu-item>
            <img src="assets\Icon\Actions_Duplicate_Icon.png" class="icon">
            <span>Duplicate Core</span>
        </button>
        <button mat-menu-item>
            <img src="assets\Icon\Actions_Hyper_Icon.png" class="icon">
            <span>Hyperlink Core</span>
        </button>
        <button mat-menu-item>
            <img src="assets\Icon\Actions_Bonds_Icon.png" class="icon">
            <span>List of Bonds</span>
        </button>
    </mat-menu>
    <mat-menu #modifications="matMenu">
        <button mat-menu-item>
            <img src="assets\Icon\Mods_Add_Icon.png" class="icon">
            <span>Add Rune</span>
        </button>
        <button mat-menu-item>
            <img src="assets\Icon\Mods_List_Icon.png" class="icon">
            <span>List of Runes</span>
        </button>
    </mat-menu>

    <ng-template
        cdkConnectedOverlay
        [cdkConnectedOverlayOrigin]="trigger"
        [cdkConnectedOverlayOpen]="designIsOpen"
    >
        <div class="designMenu" cdkDrag (cdkDragEnded)="onDesignDrop($event)"  (cdkDragStarted)="onDesHold()"  fxLayout="column">
            <div cdkDragHandle matRipple (mouseup)="getMousePos($event)" class="designDragHandle" matTooltip="Drag the Design Menu" matTooltipShowDelay="800" matTooltipPosition="before">
                <span class="dot2"></span>
                <span class="dot2"></span>
                <span class="dot2"></span>
            </div>
            <mat-tab-group   mat-align-tabs="start" fxFlex  (focusChange)="closeDesign($event)">
                <mat-tab class="tabDes">
                    <ng-template mat-tab-label>
                        <img src="assets\Icon\Design_Frame.png" class="iconDesTab">
                        Frame
                    </ng-template>
                    <div fxLayout="row" class="desWin2">
                        <div class="desTools" fxLayout="column">
                            <div class="toolRow" fxLayout="row">
                                <button mat-stroked-button fxFlex matTooltip="Transform" matTooltipShowDelay="500" matTooltipPosition="before"> <img src="assets\Icon\Design_Frame_Transform.png" class="iconT"> </button>
                                <button mat-stroked-button fxFlex matTooltip="Select" matTooltipShowDelay="500" matTooltipPosition="after"> <img src="assets\Icon\Design_Frame_Select.png" class="iconT"> </button>
                            </div>
                            <div class="toolRow" fxLayout="row">
                                <button mat-stroked-button fxFlex matTooltip="Spline" matTooltipShowDelay="500" matTooltipPosition="before"> <img src="assets\Icon\Design_Frame_Spline.png" class="iconT"> </button>
                                <button mat-stroked-button fxFlex matTooltip="Blob" matTooltipShowDelay="500" matTooltipPosition="after"> <img src="assets\Icon\Design_Frame_Blob.png" class="iconT"> </button>
                            </div>
                            <div class="toolRow">
                                <button mat-stroked-button [matMenuTriggerFor]="shapes"
                                fxFlex matTooltip="Shapes" matTooltipShowDelay="500" matTooltipPosition="before"> <img src="assets\Icon\Design_Frame_Shapes.png" class="iconT"> </button>
                            </div>
                            <div class="toolRow" fxLayout="row">
                                <button mat-stroked-button [matMenuTriggerFor]="transparency"
                                fxFlex matTooltip="Transparency" matTooltipShowDelay="500" matTooltipPosition="before"> <img src="assets\Icon\Design_Frame_Transparency.png" class="iconT"> </button>
                                <button mat-stroked-button [matMenuTriggerFor]="colour"
                                fxFlex matTooltip="Colour" matTooltipShowDelay="500" matTooltipPosition="after"> <img src="assets\Icon\Design_Frame_Colour.png" class="iconT"> </button>
                            </div>
                            <div class="toolRow" fxLayout="row">
                                <button mat-stroked-button [matMenuTriggerFor]="thickness"
                                fxFlex matTooltip="Line Thickness" matTooltipShowDelay="500" matTooltipPosition="before"> <img src="assets\Icon\Design_Frame_Thickness.png" class="iconT"> </button>
                                <button mat-stroked-button [matMenuTriggerFor]="emmitance"
                                fxFlex matTooltip="Frame Emmitance" matTooltipShowDelay="500" matTooltipPosition="after"> <img src="assets\Icon\Design_Frame_Emmitance.png" class="iconT"> </button>
                            </div>
                            <div class="toolRow">
                                <button mat-stroked-button fxFlex matTooltip="Add Frame Instance" matTooltipShowDelay="500" matTooltipPosition="before"> <img src="assets\Icon\Design_Frame_AddFrameInst.png" class="iconT"> </button>
                            </div>
                        </div>
                        <div class="desDivs">
                            frame display
                        </div>
                    </div>
                </mat-tab>
            
                <mat-tab class="tabDes">
                    <ng-template mat-tab-label>
                        <img src="assets\Icon\Design_Glazing.png" class="iconDesTab">
                        Glazing
                    </ng-template>
                    <div fxLayout="row" class="desWin2">
                        <div class="desTools" fxLayout="column">
                            <div class="menuText">Drawing Tools</div>
                            <div class="toolRow" fxLayout="row">
                                <button mat-stroked-button fxFlex matTooltip="Pencil" matTooltipShowDelay="500" matTooltipPosition="before"> <img src="assets\Icon\Design_Glazing_Pencil.png" class="iconT"> </button>
                                <button mat-stroked-button fxFlex matTooltip="Spline" matTooltipShowDelay="500" matTooltipPosition="after"> <img src="assets\Icon\Design_Frame_Spline.png" class="iconT"> </button>
                            </div>
                            <div class="toolRow" fxLayout="row">
                                <button mat-stroked-button [matMenuTriggerFor]="thickness"
                                fxFlex matTooltip="Line Thickness" matTooltipShowDelay="500" matTooltipPosition="before"> <img src="assets\Icon\Design_Frame_Thickness.png" class="iconT"> </button>
                                <button mat-stroked-button fxFlex matTooltip="Eraser" matTooltipShowDelay="500" matTooltipPosition="after"> <img src="assets\Icon\Design_Glazing_Eraser.png" class="iconT"> </button>
                            </div>
                            <div class="toolRow">
                                <button mat-stroked-button [matMenuTriggerFor]="shapes"
                                fxFlex matTooltip="Shapes" matTooltipShowDelay="500" matTooltipPosition="before"> <img src="assets\Icon\Design_Frame_Shapes.png" class="iconT"> </button>
                            </div>
                            <div class="toolRow" fxLayout="row">
                                <button mat-stroked-button [matMenuTriggerFor]="transparency"
                                fxFlex matTooltip="Drawing Transparency" matTooltipShowDelay="500" matTooltipPosition="before">  <img src="assets\Icon\Design_Frame_Transparency.png" class="iconT"> </button>
                                <button mat-stroked-button [matMenuTriggerFor]="colour"
                                fxFlex matTooltip="Drawing Colour" matTooltipShowDelay="500" matTooltipPosition="after"> <img src="assets\Icon\Design_Frame_Colour.png" class="iconT"> </button>
                            </div>
                            <mat-divider></mat-divider>
                            <div class="menuText">Background</div> 
                            <div class="toolRow" fxLayout="row">
                                <button mat-stroked-button [matMenuTriggerFor]="transparency"
                                fxFlex matTooltip="Background Transparency" matTooltipShowDelay="500" matTooltipPosition="before"> <img src="assets\Icon\Design_Frame_Transparency.png" class="iconT"> </button>
                                <button mat-stroked-button [matMenuTriggerFor]="colour"
                                fxFlex matTooltip="Background Colour" matTooltipShowDelay="500" matTooltipPosition="after"> <img src="assets\Icon\Design_Frame_Colour.png" class="iconT"> </button>
                            </div>
                        </div>
                        <div class="desDivs">
                            Glazing display
                        </div>
                    </div>
                </mat-tab>
            
                <mat-tab class="tabDes">
                    <ng-template mat-tab-label>
                        <img src="assets\Icon\Design_Datum.png" class="iconDesTab">
                        Datum
                    </ng-template>
                    <div fxLayout="row" class="desWin2">
                        <div class="desTools" fxLayout="column">
                            <div class="toolRow">
                                <button mat-stroked-button fxFlex matTooltip="Datum Type">Verse</button>
                            </div>
                            <mat-divider></mat-divider>
                            <div class="toolRow">
                                <button mat-stroked-button fxFlex matTooltip="Font">Helvetica</button>
                            </div>
                            <div class="toolRow" fxLayout="row">
                                <button mat-icon-button fxFlex matTooltip="Bold" matTooltipShowDelay="500" matTooltipPosition="before"> <img src="assets\Icon\Design_Datum_Bold.png" class="iconV"> </button>
                                <button mat-icon-button fxFlex matTooltip="Italics" matTooltipShowDelay="800"> <img src="assets\Icon\Design_Datum_Italics.png" class="iconV"> </button>
                                <button mat-icon-button fxFlex matTooltip="Underscore" matTooltipShowDelay="500" matTooltipPosition="after"> <img src="assets\Icon\Design_Datum_Underscore.png" class="iconV"> </button>
                            </div>
                            <div class="toolRow" fxLayout="row">
                                <button mat-stroked-button fxFlex matTooltip="Font Size" matTooltipShowDelay="500" matTooltipPosition="before"> 16 </button>
                                <button mat-stroked-button [matMenuTriggerFor]="colour"
                                fxFlex matTooltip="Colour" matTooltipShowDelay="500" matTooltipPosition="after"> <img src="assets\Icon\Design_Datum_FontColor.png" class="iconT"> </button>
                            </div>
                            <div class="toolRow" fxLayout="row">
                                <button mat-stroked-button fxFlex matTooltip="Justification" matTooltipShowDelay="500" matTooltipPosition="before"> <img src="assets\Icon\Design_Datum_Justify.png" class="iconT"> </button>
                                <button mat-stroked-button fxFlex matTooltip="List" matTooltipShowDelay="500" matTooltipPosition="after"> <img src="assets\Icon\Design_Datum_List.png" class="iconT"> </button>
                            </div>
                            <mat-divider></mat-divider>
                            <div fxLayout="column" class="checkedDes2">
                                <mat-checkbox class="checkedDes" fxFlex matTooltip="Share Datum with other Cores" matTooltipShowDelay="500" matTooltipPosition="before">Cast Datum</mat-checkbox>
                                <mat-checkbox class="checkedDes" fxFlex matTooltip="Display Core's Name in Shell" matTooltipShowDelay="500" matTooltipPosition="after"> Show Name</mat-checkbox>
                            </div>
                            <mat-divider></mat-divider>
                            <div class="toolRow">
                                <button mat-stroked-button color="warn" fxFlex>Clear Datum</button>
                            </div>
                        </div>
                        <div class="desDivs">
                            Datum display
                        </div>
                    </div>
                </mat-tab>
                <mat-tab >
                    <ng-template mat-tab-label>
                        <mat-icon matTooltip="Close Design Window">close</mat-icon>
                    </ng-template>
                </mat-tab>
            </mat-tab-group>
        </div>
    </ng-template>

    <!-- Core Menu sub-menues -->
    <mat-menu #shapes="matMenu"></mat-menu>
    <mat-menu #transparency="matMenu">
        <mat-slider invert="true" ></mat-slider>
    </mat-menu>
    <mat-menu #colour="matMenu"></mat-menu>
    <mat-menu #emmitance="matMenu">
        <mat-slider></mat-slider>
    </mat-menu>
    <mat-menu #thickness="matMenu"></mat-menu>


    <!-- Shell -->

    <div>
        <svg class="svgShell"  [attr.width]="shellSize[0]" [attr.height]="shellSize[1]">

            <!-- shell shape options -->
            <rect *ngIf="shellShape === 'rectangle'"
             x="5" y="5" rx="10" ry="10" [attr.width]="shellSize[0] - 10" [attr.height]="shellSize[1] - 10"  
             [attr.stroke-width]="coreData.frameThickness" [attr.stroke]="coreData.frameColor" [attr.stroke-opacity]="coreData.frameTransparency" 
             [attr.fill]="coreData.glazingColor" [attr.fill-opacity]="coreData.glazingTransparency" />

            <circle *ngIf="shellShape === 'circle'" 
             [attr.r]="coreData.size[0]/2 - 5"  [attr.cx]="coreData.size[0]/2"  [attr.cy]="coreData.size[0]/2"
             [attr.stroke-width]="coreData.frameThickness" [attr.stroke]="coreData.frameColor" [attr.stroke-opacity]="coreData.frameTransparency" 
             [attr.fill]="coreData.glazingColor" [attr.fill-opacity]="coreData.glazingTransparency" />

            <polygon *ngIf="shellShape === 'polygon'"
             points="0,100 50,25 50,75 100,0"
             [attr.stroke-width]="coreData.frameThickness" [attr.stroke]="coreData.frameColor" [attr.stroke-opacity]="coreData.frameTransparency" 
             [attr.fill]="coreData.glazingColor" [attr.fill-opacity]="coreData.glazingTransparency" />

            <!-- datum display -->
            <text [attr.x]="textX" [attr.y]="textY" fill="red" > {{coreData.datumText}} </text>

        </svg>
    </div>
  
</div>